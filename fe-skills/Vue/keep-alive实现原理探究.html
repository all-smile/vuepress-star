<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>keep-alive实现原理探究 | 看见另一种可能</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/vuepress-star/logo.jpg">
    <meta name="description" content="风之积也不厚，则其负大翼也无力">
    
    <link rel="preload" href="/vuepress-star/assets/css/0.styles.c51e8d4d.css" as="style"><link rel="preload" href="/vuepress-star/assets/js/app.7a7a38f6.js" as="script"><link rel="preload" href="/vuepress-star/assets/js/2.fea80727.js" as="script"><link rel="preload" href="/vuepress-star/assets/js/6.bb9d2512.js" as="script"><link rel="preload" href="/vuepress-star/assets/js/7.f41a1aee.js" as="script"><link rel="prefetch" href="/vuepress-star/assets/js/10.0677eaa7.js"><link rel="prefetch" href="/vuepress-star/assets/js/11.45e0ed3c.js"><link rel="prefetch" href="/vuepress-star/assets/js/12.3d8c3ce8.js"><link rel="prefetch" href="/vuepress-star/assets/js/13.42363c0a.js"><link rel="prefetch" href="/vuepress-star/assets/js/14.947af57b.js"><link rel="prefetch" href="/vuepress-star/assets/js/15.f1d16986.js"><link rel="prefetch" href="/vuepress-star/assets/js/16.e58cca5d.js"><link rel="prefetch" href="/vuepress-star/assets/js/17.0da1c1ed.js"><link rel="prefetch" href="/vuepress-star/assets/js/18.e255c943.js"><link rel="prefetch" href="/vuepress-star/assets/js/19.4773e21e.js"><link rel="prefetch" href="/vuepress-star/assets/js/20.54edcf79.js"><link rel="prefetch" href="/vuepress-star/assets/js/21.e54115a3.js"><link rel="prefetch" href="/vuepress-star/assets/js/22.c662f2c7.js"><link rel="prefetch" href="/vuepress-star/assets/js/23.94ad6a5c.js"><link rel="prefetch" href="/vuepress-star/assets/js/24.1eaf2722.js"><link rel="prefetch" href="/vuepress-star/assets/js/25.76cc3727.js"><link rel="prefetch" href="/vuepress-star/assets/js/26.5bb8363b.js"><link rel="prefetch" href="/vuepress-star/assets/js/27.aad12d68.js"><link rel="prefetch" href="/vuepress-star/assets/js/28.bacba3f9.js"><link rel="prefetch" href="/vuepress-star/assets/js/29.c051ed9b.js"><link rel="prefetch" href="/vuepress-star/assets/js/3.09ff60c9.js"><link rel="prefetch" href="/vuepress-star/assets/js/30.5dbaf637.js"><link rel="prefetch" href="/vuepress-star/assets/js/31.8a958391.js"><link rel="prefetch" href="/vuepress-star/assets/js/32.bc987a25.js"><link rel="prefetch" href="/vuepress-star/assets/js/33.dbe76a67.js"><link rel="prefetch" href="/vuepress-star/assets/js/34.b974f9b6.js"><link rel="prefetch" href="/vuepress-star/assets/js/35.21e46987.js"><link rel="prefetch" href="/vuepress-star/assets/js/36.184ace8a.js"><link rel="prefetch" href="/vuepress-star/assets/js/37.951ce2da.js"><link rel="prefetch" href="/vuepress-star/assets/js/38.6521f29d.js"><link rel="prefetch" href="/vuepress-star/assets/js/39.eb2b3a61.js"><link rel="prefetch" href="/vuepress-star/assets/js/4.f41054c5.js"><link rel="prefetch" href="/vuepress-star/assets/js/40.edcf9578.js"><link rel="prefetch" href="/vuepress-star/assets/js/41.6206f40f.js"><link rel="prefetch" href="/vuepress-star/assets/js/42.b4c7b6f5.js"><link rel="prefetch" href="/vuepress-star/assets/js/43.87c7f5ee.js"><link rel="prefetch" href="/vuepress-star/assets/js/44.b74c2679.js"><link rel="prefetch" href="/vuepress-star/assets/js/45.c116ea32.js"><link rel="prefetch" href="/vuepress-star/assets/js/46.0ecd7ef0.js"><link rel="prefetch" href="/vuepress-star/assets/js/47.6f33db6d.js"><link rel="prefetch" href="/vuepress-star/assets/js/48.3b258416.js"><link rel="prefetch" href="/vuepress-star/assets/js/49.f319a054.js"><link rel="prefetch" href="/vuepress-star/assets/js/5.6de4aac3.js"><link rel="prefetch" href="/vuepress-star/assets/js/50.0abe8279.js"><link rel="prefetch" href="/vuepress-star/assets/js/51.ccb1860e.js"><link rel="prefetch" href="/vuepress-star/assets/js/52.df21abe7.js"><link rel="prefetch" href="/vuepress-star/assets/js/53.5ce2c577.js"><link rel="prefetch" href="/vuepress-star/assets/js/54.e9c13bbb.js"><link rel="prefetch" href="/vuepress-star/assets/js/55.dbef6e1c.js"><link rel="prefetch" href="/vuepress-star/assets/js/56.5a51e206.js"><link rel="prefetch" href="/vuepress-star/assets/js/57.403e757f.js"><link rel="prefetch" href="/vuepress-star/assets/js/58.58f37fc5.js"><link rel="prefetch" href="/vuepress-star/assets/js/59.afb8929b.js"><link rel="prefetch" href="/vuepress-star/assets/js/60.95c96ac6.js"><link rel="prefetch" href="/vuepress-star/assets/js/61.d9415c86.js"><link rel="prefetch" href="/vuepress-star/assets/js/62.0065c511.js"><link rel="prefetch" href="/vuepress-star/assets/js/63.7a52b66e.js"><link rel="prefetch" href="/vuepress-star/assets/js/64.9db05aea.js"><link rel="prefetch" href="/vuepress-star/assets/js/65.62402ebd.js"><link rel="prefetch" href="/vuepress-star/assets/js/66.d3b6c7e2.js"><link rel="prefetch" href="/vuepress-star/assets/js/67.64502738.js"><link rel="prefetch" href="/vuepress-star/assets/js/68.ee950fb7.js"><link rel="prefetch" href="/vuepress-star/assets/js/69.079682aa.js"><link rel="prefetch" href="/vuepress-star/assets/js/70.b8fdeed8.js"><link rel="prefetch" href="/vuepress-star/assets/js/71.99104d1b.js"><link rel="prefetch" href="/vuepress-star/assets/js/72.b73666d7.js"><link rel="prefetch" href="/vuepress-star/assets/js/73.0a1090ff.js"><link rel="prefetch" href="/vuepress-star/assets/js/74.2a8c5bde.js"><link rel="prefetch" href="/vuepress-star/assets/js/75.c4cecd97.js"><link rel="prefetch" href="/vuepress-star/assets/js/8.b18e8b8a.js"><link rel="prefetch" href="/vuepress-star/assets/js/9.c1bd2f79.js">
    <link rel="stylesheet" href="/vuepress-star/assets/css/0.styles.c51e8d4d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-star/" class="home-link router-link-active"><!----> <span class="site-name">看见另一种可能</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="精神花园" class="dropdown-title"><span class="title">精神花园</span> <span class="arrow down"></span></button> <button type="button" aria-label="精神花园" class="mobile-dropdown-title"><span class="title">精神花园</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-star/mao/" class="nav-link">
  毛泽东思想
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-star/sikao/" class="nav-link">
  事件思考记录
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="雪泥鸿爪" class="dropdown-title"><span class="title">雪泥鸿爪</span> <span class="arrow down"></span></button> <button type="button" aria-label="雪泥鸿爪" class="mobile-dropdown-title"><span class="title">雪泥鸿爪</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-star/see/" class="nav-link">
  🥝书籍/电影
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-star/bling/" class="nav-link">
  🥝吉光片羽
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><span class="title">知识库</span> <span class="arrow down"></span></button> <button type="button" aria-label="知识库" class="mobile-dropdown-title"><span class="title">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-star/fe-skills/" class="nav-link router-link-active">
  🥝偏前端开发实用技能
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-star/fe-framework/" class="nav-link">
  🎈偏前端架构运维小火慢炖
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="空间" class="dropdown-title"><span class="title">空间</span> <span class="arrow down"></span></button> <button type="button" aria-label="空间" class="mobile-dropdown-title"><span class="title">空间</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/852876755212814/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎈掘金（优秀创作者）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://mp.weixin.qq.com/s/SUT82RsrhUL46VP98lk-6A" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎃微信公众号
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://home.i-xiao.space/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎨互联主页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/xiaojt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ✨语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.i-xiao.space/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎉Hexo个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/all-smile" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎊博客园
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/all-smile/vuepress-star" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="精神花园" class="dropdown-title"><span class="title">精神花园</span> <span class="arrow down"></span></button> <button type="button" aria-label="精神花园" class="mobile-dropdown-title"><span class="title">精神花园</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-star/mao/" class="nav-link">
  毛泽东思想
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-star/sikao/" class="nav-link">
  事件思考记录
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="雪泥鸿爪" class="dropdown-title"><span class="title">雪泥鸿爪</span> <span class="arrow down"></span></button> <button type="button" aria-label="雪泥鸿爪" class="mobile-dropdown-title"><span class="title">雪泥鸿爪</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-star/see/" class="nav-link">
  🥝书籍/电影
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-star/bling/" class="nav-link">
  🥝吉光片羽
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><span class="title">知识库</span> <span class="arrow down"></span></button> <button type="button" aria-label="知识库" class="mobile-dropdown-title"><span class="title">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-star/fe-skills/" class="nav-link router-link-active">
  🥝偏前端开发实用技能
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-star/fe-framework/" class="nav-link">
  🎈偏前端架构运维小火慢炖
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="空间" class="dropdown-title"><span class="title">空间</span> <span class="arrow down"></span></button> <button type="button" aria-label="空间" class="mobile-dropdown-title"><span class="title">空间</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/852876755212814/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎈掘金（优秀创作者）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://mp.weixin.qq.com/s/SUT82RsrhUL46VP98lk-6A" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎃微信公众号
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://home.i-xiao.space/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎨互联主页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.yuque.com/xiaojt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ✨语雀
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.i-xiao.space/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎉Hexo个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/all-smile" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎊博客园
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/all-smile/vuepress-star" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>个人网站汇总导航</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>🎃代码规范控制</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>🍿基础框架优化项</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>🎯Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-star/fe-skills/Vue/env[mode]文件中如何添加注释.html" class="sidebar-link">env[mode]文件中如何添加注释</a></li><li><a href="/vuepress-star/fe-skills/Vue/vue实用技巧.html" class="sidebar-link">vue实用技巧</a></li><li><a href="/vuepress-star/fe-skills/Vue/vue组件通信的方式.html" class="sidebar-link">vue组件通信的方式</a></li><li><a href="/vuepress-star/fe-skills/Vue/🎀Vue自定义指令.html" class="sidebar-link">🎀Vue自定义指令</a></li><li><a href="/vuepress-star/fe-skills/Vue/控制点菜单管理.html" class="sidebar-link">控制点菜单管理</a></li><li><a href="/vuepress-star/fe-skills/Vue/$emit,$on实现原理剖析.html" class="sidebar-link">$emit,$on实现原理剖析</a></li><li><a href="/vuepress-star/fe-skills/Vue/keep-alive实现原理探究.html" class="active sidebar-link">keep-alive实现原理探究</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-star/fe-skills/Vue/keep-alive实现原理探究.html#vue2-x-源码-keep-alive" class="sidebar-link">Vue2.X 源码(keep-alive)：</a></li><li class="sidebar-sub-header"><a href="/vuepress-star/fe-skills/Vue/keep-alive实现原理探究.html#关于-keep-alive" class="sidebar-link">关于 keep-alive</a></li><li class="sidebar-sub-header"><a href="/vuepress-star/fe-skills/Vue/keep-alive实现原理探究.html#keep-alive解析" class="sidebar-link">keep-alive解析</a></li><li class="sidebar-sub-header"><a href="/vuepress-star/fe-skills/Vue/keep-alive实现原理探究.html#👉渲染总结" class="sidebar-link">👉渲染总结</a></li><li class="sidebar-sub-header"><a href="/vuepress-star/fe-skills/Vue/keep-alive实现原理探究.html#基于-keep-alive-缓存实现方案" class="sidebar-link">基于 keep-alive 缓存实现方案</a></li><li class="sidebar-sub-header"><a href="/vuepress-star/fe-skills/Vue/keep-alive实现原理探究.html#场景分析" class="sidebar-link">场景分析</a></li></ul></li><li><a href="/vuepress-star/fe-skills/Vue/diff算法.html" class="sidebar-link">diff算法</a></li><li><a href="/vuepress-star/fe-skills/Vue/vue扩展插件，自定义原型方法挂载.html" class="sidebar-link">vue扩展插件，自定义原型方法挂载</a></li><li><a href="/vuepress-star/fe-skills/Vue/vue-router之hash与history.html" class="sidebar-link">vue-router之hash与history</a></li><li><a href="/vuepress-star/fe-skills/Vue/vuecli4创建项目.html" class="sidebar-link">vuecli4创建项目</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="keep-alive实现原理探究"><a href="#keep-alive实现原理探究" class="header-anchor">#</a> keep-alive实现原理探究</h1> <p>原文： <a href="https://juejin.cn/post/6930915968655261703" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6930915968655261703<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>原文有删改</p> <h2 id="vue2-x-源码-keep-alive"><a href="#vue2-x-源码-keep-alive" class="header-anchor">#</a> Vue2.X 源码(keep-alive)：</h2> <p>缓存的是整个 <strong>VNode</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* @flow */</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> isRegExp<span class="token punctuation">,</span> remove <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'shared/util'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getFirstComponentChild <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'core/vdom/helpers/index'</span>

type CacheEntry <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token operator">?</span>string<span class="token punctuation">;</span>
  tag<span class="token operator">:</span> <span class="token operator">?</span>string<span class="token punctuation">;</span>
  componentInstance<span class="token operator">:</span> Component<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

type CacheEntryMap <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token operator">?</span>CacheEntry <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getComponentName</span> <span class="token punctuation">(</span><span class="token parameter">opts<span class="token operator">:</span> <span class="token operator">?</span>VNodeComponentOptions</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>string <span class="token punctuation">{</span>
  <span class="token keyword">return</span> opts <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>Ctor<span class="token punctuation">.</span>options<span class="token punctuation">.</span>name <span class="token operator">||</span> opts<span class="token punctuation">.</span>tag<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">matches</span> <span class="token punctuation">(</span><span class="token parameter">pattern<span class="token operator">:</span> string <span class="token operator">|</span> RegExp <span class="token operator">|</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span> name<span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> pattern<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pattern <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> pattern<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRegExp</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> pattern<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* istanbul ignore next */</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">pruneCache</span> <span class="token punctuation">(</span><span class="token parameter">keepAliveInstance<span class="token operator">:</span> any<span class="token punctuation">,</span> filter<span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> _vnode <span class="token punctuation">}</span> <span class="token operator">=</span> keepAliveInstance
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entry<span class="token operator">:</span> <span class="token operator">?</span>CacheEntry <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> entry<span class="token punctuation">.</span>name
      <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> _vnode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">pruneCacheEntry</span> <span class="token punctuation">(</span>
  <span class="token parameter">cache<span class="token operator">:</span> CacheEntryMap<span class="token punctuation">,</span>
  key<span class="token operator">:</span> string<span class="token punctuation">,</span>
  keys<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  current<span class="token operator">?</span><span class="token operator">:</span> VNode</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> entry<span class="token operator">:</span> <span class="token operator">?</span>CacheEntry <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>current <span class="token operator">||</span> entry<span class="token punctuation">.</span>tag <span class="token operator">!==</span> current<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">.</span>componentInstance<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">remove</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> patternTypes<span class="token operator">:</span> Array<span class="token operator">&lt;</span>Function<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> RegExp<span class="token punctuation">,</span> Array<span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
  abstract<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    include<span class="token operator">:</span> patternTypes<span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> patternTypes<span class="token punctuation">,</span>
    max<span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">cacheVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> vnodeToCache<span class="token punctuation">,</span> keyToCache <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>vnodeToCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> tag<span class="token punctuation">,</span> componentInstance<span class="token punctuation">,</span> componentOptions <span class="token punctuation">}</span> <span class="token operator">=</span> vnodeToCache
        cache<span class="token punctuation">[</span>keyToCache<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>
          tag<span class="token punctuation">,</span>
          componentInstance<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>keyToCache<span class="token punctuation">)</span>
        <span class="token comment">// prune oldest entry</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max <span class="token operator">&amp;&amp;</span> keys<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vnodeToCache <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'include'</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'exclude'</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">updated</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheVNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default
    <span class="token keyword">const</span> vnode<span class="token operator">:</span> VNode <span class="token operator">=</span> <span class="token function">getFirstComponentChild</span><span class="token punctuation">(</span>slot<span class="token punctuation">)</span>
    <span class="token keyword">const</span> componentOptions<span class="token operator">:</span> <span class="token operator">?</span>VNodeComponentOptions <span class="token operator">=</span> vnode <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>componentOptions
    <span class="token keyword">if</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// check pattern</span>
      <span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> include<span class="token punctuation">,</span> exclude <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token comment">// not included</span>
        <span class="token punctuation">(</span>include <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token comment">// excluded</span>
        <span class="token punctuation">(</span>exclude <span class="token operator">&amp;&amp;</span> name <span class="token operator">&amp;&amp;</span> <span class="token function">matches</span><span class="token punctuation">(</span>exclude<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> vnode
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">const</span> key<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> vnode<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token keyword">null</span>
        <span class="token comment">// same constructor may get registered as different local components</span>
        <span class="token comment">// so cid alone is not enough (#3269)</span>
        <span class="token operator">?</span> componentOptions<span class="token punctuation">.</span>Ctor<span class="token punctuation">.</span>cid <span class="token operator">+</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">.</span>tag <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">::</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>componentOptions<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> vnode<span class="token punctuation">.</span>key
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>componentInstance
        <span class="token comment">// make current key freshest</span>
        <span class="token function">remove</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// delay setting the cache until update</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vnodeToCache <span class="token operator">=</span> vnode
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyToCache <span class="token operator">=</span> key
      <span class="token punctuation">}</span>

      vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keepAlive <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vnode <span class="token operator">||</span> <span class="token punctuation">(</span>slot <span class="token operator">&amp;&amp;</span> slot<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br></div></div><h2 id="关于-keep-alive"><a href="#关于-keep-alive" class="header-anchor">#</a> 关于 keep-alive</h2> <p>keep-alive 是一个抽象组件，不会和子组件建立父子关系，也不会作为节点渲染到页面上。</p> <p>关于<strong>抽象组件</strong> Vue 的文档没有提这个概念，它有一个属性 abstract 为 true，在抽象组件的生命周期过程中，我们可以对包裹的子组件监听的事件进行拦截，也可以对子组件进行 Dom 操作，从而可以对我们需要的功能进行封装，而不需要关心子组件的具体实现。除了kepp-alive还有<code>&lt;transition&gt;&lt;transition-group&gt;</code>等。</p> <h3 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h3> <ul><li>能在组件切换过程中将状态保留在内存中，防止重复渲染DOM。</li> <li>避免反复渲染影响页面性能，同时也可以很大程度上减少接口请求，减小服务器压力。</li> <li>能够进行路由缓存和组件缓存。</li></ul> <h3 id="activated"><a href="#activated" class="header-anchor">#</a> Activated</h3> <p>keep-alive 的模式下多了 activated 这个生命周期函数, keep-alive 的声明周期执行:</p> <ul><li>页面第一次进入，钩子的触发顺序</li></ul> <p>created-&gt; mounted-&gt; activated，退出时触发 deactivated 当再次进入（前进或者后退）时，只触发 activated。</p> <ul><li>事件挂载的方法等，只执行一次的放在 mounted 中；组件每次进去执行的方法放在 activated 中。</li></ul> <h2 id="keep-alive解析"><a href="#keep-alive解析" class="header-anchor">#</a> keep-alive解析</h2> <p><strong>源码文件位置</strong>： <code>source-code\vue\src\core\components\keep-alive.js</code></p> <h3 id="渲染"><a href="#渲染" class="header-anchor">#</a> 渲染</h3> <p>keep-alive 是由 render 函数决定渲染结果,在开头会获取插槽内的子元素，调用 **getFirstComponentChild **获取到第一个子元素的 VNode。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default
<span class="token keyword">const</span> vnode<span class="token operator">:</span> VNode <span class="token operator">=</span> <span class="token function">getFirstComponentChild</span><span class="token punctuation">(</span>slot<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接着判断当前组件<strong>是否符合缓存条件</strong>，组件名与 include 不匹配或与 exclude 匹配都会直接退出并返回 VNode，不走缓存机制。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// check pattern</span>
<span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> include<span class="token punctuation">,</span> exclude <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>
<span class="token comment">// not included</span>
<span class="token punctuation">(</span>include <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
<span class="token comment">// excluded</span>
<span class="token punctuation">(</span>exclude <span class="token operator">&amp;&amp;</span> name <span class="token operator">&amp;&amp;</span> <span class="token function">matches</span><span class="token punctuation">(</span>exclude<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> vnode
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>匹配条件通过会进入缓存机制的逻辑，如果命中缓存，从 cache 中获取缓存的实例设置到当前的组件上，并调整 key 的位置将其放到最后(<strong>LRU 策略</strong>)。 如果没命中缓存，将当前 VNode 缓存起来，并加入当前组件的 key。如果缓存组件的数量超出 max 的值，即缓存空间不足，则调用 **pruneCacheEntry **将最旧的组件从缓存中删除，即 keys[0] 的组件。之后将组件的 keepAlive 标记为 true，表示它是被缓存的组件。</p> <blockquote><p>LRU 缓存策略：从内存中找出最久未使用的数据置换新的数据。<br>
算法根据数据的历史访问记录来进行淘汰数据，其核心思想是：如果数据最近被访问过，那么将来被访问的几率也更高。</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
<span class="token keyword">const</span> key<span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> vnode<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token keyword">null</span>
<span class="token comment">// same constructor may get registered as different local components</span>
<span class="token comment">// so cid alone is not enough (#3269)</span>
  <span class="token operator">?</span> componentOptions<span class="token punctuation">.</span>Ctor<span class="token punctuation">.</span>cid <span class="token operator">+</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">.</span>tag <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">::</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>componentOptions<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token operator">:</span> vnode<span class="token punctuation">.</span>key
<span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>componentInstance
  <span class="token comment">// make current key freshest</span>
  <span class="token function">remove</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> vnode
  keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token comment">// prune oldest entry</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max <span class="token operator">&amp;&amp;</span> keys<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>pruneCacheEntry 负责将组件从缓存中删除，它会调用组件 $destroy 方法销毁组件实例，缓存组件置空，并移除对应的 key。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">pruneCacheEntry</span> <span class="token punctuation">(</span>
  <span class="token parameter">cache<span class="token operator">:</span> CacheEntryMap<span class="token punctuation">,</span>
  key<span class="token operator">:</span> string<span class="token punctuation">,</span>
  keys<span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  current<span class="token operator">?</span><span class="token operator">:</span> VNode</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> entry<span class="token operator">:</span> <span class="token operator">?</span>CacheEntry <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>current <span class="token operator">||</span> entry<span class="token punctuation">.</span>tag <span class="token operator">!==</span> current<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">.</span>componentInstance<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token function">remove</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
  abstract<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
  <span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="👉渲染总结"><a href="#👉渲染总结" class="header-anchor">#</a> 👉渲染总结</h2> <ol><li>通过 getFirstComponentChild 获取第一个子组件，获取该组件的 name；</li> <li>通过 include 与 exclude 属性进行匹配，判断当前组件是否要被缓存，如果匹配成功；</li> <li>命中缓存则直接获取，同时更新 key 的位置；</li> <li>不命中缓存则设置进缓存，同时检查缓存的实例数量是否超过 max， 超过则根据 LRU 策略删除最近最久未使用；</li> <li>如果在中途有对 include 和 exclude 进行修改，通过 watch 来监听 include 和 exclude，在其改变时调用 pruneCache 以修改 cache 缓存中的缓存数据。</li></ol> <hr> <h2 id="基于-keep-alive-缓存实现方案"><a href="#基于-keep-alive-缓存实现方案" class="header-anchor">#</a> 基于 keep-alive 缓存实现方案</h2> <h3 id="方案一-整个页面缓存"><a href="#方案一-整个页面缓存" class="header-anchor">#</a> 方案一：整个页面缓存</h3> <p>一般采用在 router 的 meta 属性里增加一个 keepAlive 字段，然后在父组件或者根组件中，根据 keepAlive 字段的状态使用 keep-alive 标签，实现对路由的缓存：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$route.meta.keepAlive<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!$route.meta.keepAlive<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="方案二-动态组件缓存"><a href="#方案二-动态组件缓存" class="header-anchor">#</a> 方案二：动态组件缓存</h3> <p>使用 vuex 配合 exclude 和 include，通过 include 和 exclude 决定那些组件进行缓存。注意这里说的是组件，并且 cachedView 数组存放的是组件的名字，如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$store.state.keepAlive.cachedView<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="场景分析"><a href="#场景分析" class="header-anchor">#</a> 场景分析</h2> <p>在 SPA 应用中用户希望在 Tab 多个页面来回切换的时候，不要丢失查询的结果，关闭后清除缓存。</p> <p>如下图： <img src="data:image/png;base64,UklGRhokAABXRUJQVlA4IA4kAAAQ6QCdASrUAmYBPm02mEgkKSKhI7M5qSANiWlu+EiK7TD+yTmjWyfN9jnJn81f9f6yOW59e3mL/XD0qv2A1kD0AOmgyI/z//iPVH4q/lP7b+0voL4uPTvtp/eueb15/yvQz6e/sv8J5/f6X+++O/xq/sP7d7Av5l/QP9f/ZfW2+3/WjvSdj/3n7B+wL7W/Wv+7/ivHc/tP7z6qfXb/h/2/+7/ID/P/7Z/s/Uv/b+Fr93/0v6r/AF/Of7z/3/7H7tv+H/6/7x6A/rT/5f3b4Cft79uP2Q/vL7OP7ojHtZgE8duduZuqHoZ4te6z5fAsQseU0vLANbJGYawp2qsA1hTtVYBrCnaqwDWFO1VgGsDyCKIJTWvwA3jzEIMpTUyg9Z7c+JZCoxbaAdFJwnrif+C/uPqGEF3lKtchMFTchAyE+rZUVjkIGQn1bKisQVHgAm3uyFy9QN4P0UAtbkA8NYS8GACkhgYFcDMd2kREeWMgOz1ONNX3tCwaEcsToaElwZUv1Okk1YwS62BWRNv+DHTzkk/qri/u9YuST+quL+5M+utfpsyqSSfkuzfTlXTuAf1pbBuCvvziskG09ln43VF0SG6vIjUFelbsCk9Pxu034ysZk5EueEq55CiQH3nv93rFySf1Vxf3esXJJ/VVR+zPQgL8r4zbE9TezpkyOgcPv1KYBEcc+cmdSBYtsCTHXWTF8+ZbF/d6xckn9VcX93rFxt0QkDW7U0WFeRkHM0pfCaDIsklQkJjzDcy/LXD+j4X9P6aaC4bGpkiEaMnZjrOaGmd52p2xaHPG0UrUZ9HHQZ2XkCX/hFyXuTOXx7U/6XnO2IGGnYh+DHJqm36ptIc2QZywAI6pIcsG7dPGQbO8f5uiAghytOGZnWxN3R3au5fIg6Etf9gz9UcYpY/hmlws6eVPTxXY6nNe4aA+HsiWHDcKaTmXmPqzP3Qy9T3e+n8x8SsraaDr+s8dKWkazA7KsGA0X+AoOwKDOsuRP+1icaR/a6FacVgz5ZnTrudx7V9HxoDY/0OUyT9muA7WUeOihaiQMaiFT592fUd11EYsiQ6GSe+jdMcFxGz9lMt1BEP5OoW98GxbxfVm/ybjRMzfunDNHC0CXt6xkpCyYo3SlUI2mJg+glZxLLk4gL1jYCV2LiHVqEXUEFF9+MTmKgzXdeoA2yypyjL0ZDTXt4uZI6pDMDvj1wUK6eqiPuprONOZaSbWQ8Lp/qU3iQmlwOalcelgm56gM+5wuNmUGVLXQG6I1RDZUImKzeWol6lPCXk70mtn/ZNOniuLkNK9l5n49P28CrnKhzHg2xNZFZqR8uuz3gNTpYomEBmMvjyNQ/4mzHWdEBIUAzHNj7DHa6QTM9i5DEf1Xwg4QR1hE8IIJchAwjIHWObLopFHVkUmA3nuJChNaXr4y3AraVjn0a8qErRROALSMN5Y5w00+fcbEVJ8HQA6HXx4tG/1o3xwBblQN6rCw/If4gZiovJoZxbnVsqKxyEMJns1A4YxfybJNcfLd+G4UXiS24/tZweJJ+bXF/cmfZRRpr4kn9VcX93rA/UievUiT3KzJSRlC1jOOS2S1XbnvlIrEtyg/VisS2qznqUReW5QfqxWJWjgF6Do9+khpywWDsuJLKk2hV7Pf7/x4HxnJ+LCPYIryXe+YEJ7Q39dMno61bnZiSvuGQn1bKischAyE+rZTCMHgVSDwdj42RthmKuDkPiuljBt8KKAKiTQb8IEUG5pNC/qTSw3kKsIj1qcv7vWLkk/qri/u9YuST+quL+71bM+o0+ff57fiWZBa2RKBR7Zh20ypvWi77UWCXB9m89s9PBcGL5vyjmg5p17mEAB/EE3gNjmXhFhgGT/00tg6PoA6r1CORY9Hi3Ol1WKrvPV2C4xDch3ejlxo+K4KnQRq1KETca69hJBnj/8EXeyxrlEQcJdmWVS0YT1G+ILNw05/3C4G9519BKbi7fsLjZAN5czUJ+18ulEehTlwj1S9+26xcklbASzl9YoN78y154rOO4FWqGYJc+Fn4FofSNbYJK3DITufqiW9CULtpW7Z3BTElbhkJ9W2FWaphqXlu0ME+rZUVjj8nDNnyt3HpOQLJW8/djSfutAytt+OlOMEtao5Fx+oCEqyorHIQMqrQ2UhPnW5hF2aYamHZUVcOfagfNXeu8pVuGQn1bKizVQ1mCSrK7Rh5Hbm0nJJ/VVUhaVQ4SUlJEUpHA8msWSt8j81bjTyIYldWBEzcV1OCf8IRSUvFWUf/2TbMSnZRlNiQXdv7UujbNPdAAJSDAy+8Cl8mizioLpR2ty921WVFTHqPNxmawDQt1i5JP6q3p7vWLkir02/V7j66TM3pwc0uijT2iHWLl4CejuoRvINlYkVbwDiG4lNR1/LoIi0fgBu+oLfrNHIg5dqWp7ZJAYQN2/KyjQVh0BZ9dPkJ27wFY3kpRkE/3NpOST+quL+71i5JMVM7e1gTXyCpaQU6HyN/I2SXi5CA0vJpkQAP7hq4Vxxm0tVBnhRijaPrhEpvWVC6xd/zj7rljFaDzeywBGxqEfLx+bhuD1OWj8bJ5xxFftpB4GpkrY7isZGTKoIRcGPNxV1522ux9tX6dTrF/mDLfN2oj+wjCPR6gNpsiWR7RpcJbi2u7mobHkwoBcYgpDRVSBnEAWzsgjGyNtydX2dsd7HnyaoqTTFAYS9j/hSUdyxTI6QR9uR31mOTpab6oA9dl3x3/kBJqOobEVSaOLvL7mwbzZPjKqEM8G6hH0VFCVAxTK87FgP/MPVd0W0SsatMBrwrMa7cvlCAE9+o19trZrusHxv+jAdXAfqZg4UWgBDxh+HXeH0FPldlbHOAzSelKeVnzSgARFawIyeZ0rqoVRaXvNPAVQZM1XQKzbWWgK6FxQzTfTDuWgzpjTw86+TB7jt+NNgt9U046+rncw0LQDQjbq3Ea0f6HB1cS6Hccy0nnpDphdTQnj9X+1p1YaQYp/D3CZLWPERPs0FYrwoOXIb3n+W0jdM1DlW0xmKIBDwLQsUSA9KBfmtn9pLGzYtEa6kxQ2uAAVubXRyRvI/SJ5Uqp6lW7lfhAYsRfB5d95glntD5q0MTjgLK6LaEFBMUMczMTIDMBBeqIs6tZveUUgI2Trog/rWqXTXN2FaAFtVNtx0rHwYpfRdDvPt4k7Y62//4wPhJTDTCY11OH/WexFstT9qGw9jaGELYEEadTSdHBUbfXm6/oyEHfhO7fSBtH3LJKCmT7Yrw+Wn37hbzOMXOlSg3K/Kg4lfdGz+sOl8oSC3IBh3+TPRZGgQvIN/8SdmUFNQIBqrSQXZj395xiY2jrJ8LnCd5N6Mob77X0piEleGyPwVERs7cpLtQooLAT8iZ38L2ix6Klekt0mEGWa7NKFd90uvp2xgk7zfF3FdwvwANAY+SVe7zEopY6fFal70Z/QFWjMZzJubv4N3xExDoSD3rHzqJ56/wJCsamlSeJSSzyKyCXSPBguvwIxfFP0RKJciDb/AmAV0rUM7pFxONHSDo6hCfkBVlEsOQuCj3MsUwfA9ds1yQsQx10Z2erqQL6bcF6ACDIcc3Ns/RyugZ+8hjA92uU7+nx2C4YFj0N+ghEYOb64QIQP1vBvOOZIoMunpvhgBw7kBkCVpM4z8eEjo16gA6xGG1sF3PVXPHDz0U41NZ/0Bq1LjYD95v/DHy5OsuKJSBXdVFn0djz6k4hdnBptoM5tmPlXXrfqTtLXFL+VI/bjFdVTmGO4vF77oY6XhpWAEqmP9hp30hnpI1rKyInPVFUX6UdsccDfY85ew+xSZ4qNco7X7fDMLi4oxVY0LPrZOAILAhXtXptSSeW7ysFkBsD0+4tzo9eWRDo45YWQAaJn5mO5TxTavz0RaLjavK8CuAHnNaj7UKf4P3xDoGA0SqWW+8Z5a4X3KuE1PAyX8xEDAj5RwS3dKqJoBuiDBInMhxzeSJ9Lm8QYMwsU4gU+XLAuinijTTOAkSU/GbMSgdzSP8ID4adbfYgitcXjgPBATmJwr5RFJuiGq5DLcPfdxti7x/A/HOyCU1oeQOmQk9t+KTsGXXwM+MimFhM/2jQ35quG5/Mk04s/Dxkl4aHlEssA20YVOU4kS8GZ5UypXbsMLbcomzo4U3BJSPkW/FRu09IkcX5DYb/L2M6kP+FM4WxVwEfveLJEkqXLi0PH6nFm/DxK/WnrBubpWf2myXrmAnudDF6w1aVcOOzE9IQkJIBDcrwi0AeQnWkB1XZ3egfhd6J9j1m9Hm23s3o8229m9Hm23s3o8uuLYREm71Zu9xe54xM72rsaRwcAIABIqJTWEWItZd6zBtldtFxJeFRSdpFwDxUfzNzMvxQ9RJDbafG5eK8HvuUufOtlQYTJWsPNUAy4oynMC/nrfhrg06v3MxNOiu/mT+Uk1OjGrfTOQj0BBZqNjfA2liq6KKRacKAbUo6d65tldl6vjNrk8M1YjksoI1uOsls5lqM/98eBv9ZCPqhQIDr3h+ylaZ3pCs8nUuOhQctGxRdfELPO07cv4BWog0OQVi2bGAlqUIpO2/kqwoSZEK2q/WgRGu2kyzwK45I3mQ2zqtiVZQHWK4H+ACI3laIDtyKvImknSEy6qChoqOMgYWyjmdop+fFntM/9+MFDM0MX4VCmigklyCzierxDPxtiZvxEXJ6hJ38jaXn2GPF9PeS4pdYEQuRkSyQ0Em7Sp1po4/vo0XmgFDVi3T5YKDjZfKwsX0Wg9nlNLwNqZgIEoPRG07Xuaar2+WZexZwL+/IFbCDgFBvTM7yIdQAJJ1zx1vwIE2bu9qlNuYV4hQowHOTtMJOTXQzwtyT3qznck6+Ad4B67flCPHoQiovpyp1c2qVT2YKn0Gs6lVKJMybCav8jyX1e+uOr5Wre1sdHhPjOzt6fOTW+nfxHwopHhDOSafv/8BPsoAg5ZVv/9iwzX5h0358npsniCPvKvK4197a3DaJU4js5cNe+5/9W1OQXh//Q8VvWMspcAU+DcWdeePNKEXaQD+Pk9dw4DuaZemQJxuUdx7wc3D2IOHfF4VKZn9WO/wLvFo5YqsP5zbs/dy1Bj8AOk8jYKR05YxNAKtqFCw34b7V4pwJvEQEtS3TWKE0UBhkbkc7Ik7ecqFXcUH0OF7kRlsYNHAsoznzL1rPw2R9yWNA/ctUrC9SVXTnZALjMtohtHLUfJMDw+rChjvFqLwGiBVJexgksVDfW3IZmoi8HON0pBlu1CZZnprtugYpRQ1u9p4k/gYUhHvTmYUMANWq2UOPiLvFuewp6QGKVCIyhFMyuOTvvOZg3w03lCdr2MVBrlEaibdwmx6E24dMl0GCZs4ChNB8+jZPlvBOAbUMJefcBK6x0F5zEN7bsc/30K+VrZrIbD7sSEPjQjTzAy51U6P6NPSYck5tw5kK1zGWNiAJaFqEN+FNxKUL3iI2lGza7X6UDREm0m/o8f/q+8YU65TBxjg74TU9/5GDTiK4xBQgbHwvffLDv4uQXmEeMJ9vISbk9C71Gv1sVh08Aq6cDHRxoS1Nq16+NU8/GET8fXFTiCcPIkksAzNZIkw1q5P/iUg+hhWurQYf4tZ5RAIpweA9xBcK5WINjagMHq7P+bURCURBz6HinWaCke87gBOUUUP0o2ifqM5sShICkMBEiVo7fCDwoZVYTiZXRNvsv+zbLmCKh2KGY54KdopeP4WF6Wlz0xSTt5wLp6auUANT2AumddDqyTMpUsBGplnv8XoDnF2BuoPT4Oe6t4x7I17wdxvyLPFz5Igqp+5HDX6dXKf6fKM1c1o8x9mTukwuAwiyzIsdh2eB9bXw80gF/BmMX9rulqPp+/pTCXYnMUHuYHcfWGoutFC4ZqLEagQ0vhLlBinywL54FVGulDXA+sO6nGI1YdY5Dp5XoxNM8pdWY/lbHDpOU2svTIsg7CcUzZKJbx0IJsXN2qhpvNifvMWiInZroTvYqfWV9mJBqbjGYc8yzn9Oj69f4NUa2LUAsC/9MNj4wYWqzHXnDCsvcTFq3Pim9Wn+mu8TJXcyCnDRF4yDg/+gxldLOLnOmb3ZazEe92UEEYST5yVECYq9St9R9zHNMKX0O5dwaFFIoyD3IXr3WNxR1MepRb244fpF5nNVNJKtZdaz4C+EGVdqr71UHsoTxSsq2+GlJ/frHeTdlcNK1c9m+gGbD5e1e6UnXtBFROsEnYtPmTjd2+Uuq1BBLGXuO69xsATXX7vWjveQ0+QUdhn1bLP4hYgcs6wbwKyEypl7xsb/b8bkkn5WYdZ9qR64hxxKAQjlyPZt145Wd4AI+BXS0gBFkikHmo1qJ22jHz2f+SW7TFLA8b/tU0LbsUR1Q5e6+CCvpvlz6taXqxNnayjM/tIVJs9WYz6f1HYiXvq51IdGs9kOdsk63iGY8Rl4WqOSeIr33StjapkY93LureaWS0aSIvWh7dRjOdwzLp+JoFTMQ0Q98/915POgimIr/fs1yQuD+yUzAbFHUiU6c6WgLXfGM9XJJ+hBheYffjixQ9MI/5Z5nmQpuTGO5qeAlfRjL2e/h6yzOo5V2z6+DgD7SvfrWysjgtqF3pBo+EkWwhZSGsS4ufsprtxFfYR0lWqRtFF4V2XTNgoujc5vLFz2TAgP4cKULBQcPbiJsFvl3mHdKEyVaVROZsUfYQStNnsYtXrdnhxkZDn47zq3zh2SArDCXd2GyzZ+Zyn5mvKW9SZ5C8NqXkxjpgcdcGO4+zhN0YG9ZFvyFw6M3AQtnYk/4fH4JE1UO8ywItvzGLafa89WenpOZfHj/Kc0EWmmCOxkIxFI9MrY+qB9prF5WnPq6+dnBptlP/J6HxD9ApOO/7/iJKi5LCWsXLEr1glZj+5VssN6a0njIpyR0ItEaH68WfMQ6QBeTHm7V+XGbghGdahSkOJjgvuF6o4T2HdBaJaYvpDGk54IzhNyuICzvtgZicymLh+KPz/eIeC+7gxA9BbS2aSe8f7XxriphSZnBID9He7aP3o9i8EtCuMay+tGdMROB5jx0Bn9rVj5XdGqW2Ug8VzIYdcgElEyW3GiU0/eUjakxa0Xu7teU4lSKJN6VaTrv+gXY6c3JrqwD4R3mzsdJ2HPonifZYGmda/j9+n0JAV3kD1mAAiQAyb+XqW+DzLnGs+TEps889EtHW237tN9OFd4tc7hMisXTr6kSuyYfYpqwLPxQOao/ITwVIYTqc9Uyp9YhFdStk/8mLfKt82KfLmKU6EkA1EAXn4HymCs6CZpxyk0dlVycbVKLrmZK4ef/zW16488xLBOZGAf6fl9VxAoep/J5NLYs7DByDFdu7Dxj1APYLPVsOTgeG0oFR3U7hDd+sjtVCQ+LZ5LCVD/wgz/2rWnv1xO+yP3XIl4ZjWc4gRzDmGEjBdhCRKtR2P6LrBsaHb/HfG/Nwt8FN1K0zvty1PwiTLkHkQhxkuHrVNEbpXHSlmoGb2k//bHEGlaaZwIyJp94OpE/8wljYhiRZRvdIDy5yGoySMOcJQhbpbTUijzjPJS2RPrBsIedzkOm+sLdjtyQL5Y+l6ObPbk6Ua3kCu27QuTZQfF2Qfepg6v/vXAQuBi+tiaXGSY26qdJhwr3sa6iAvryaHML/heOUj+nxvwk0C3LNrMddREGDXRJ3HHoinE64cc/bOlnLa7ILiBtdkFv+zAhBosqD9JycWr0U57ILiBtdkFxA2uyC4gKtpbApkuL+Bq23zmOAjVwPE9tzpbMLPz0XoM4kKE2i/7CgmnsOnAWXzxRvqjnIcDZPdi3bYC2Qwmufse83TZCW9vzLycJ6zlN2EiwAAAAFlW8WtfzH/K8Ow0r3CGXsejheVP43v6oi4fObyFHRYvufMVW0RrNBJspBix3R52sfGm9WcP94in8LQ+Zu2jGSY/fPMpCNY/6wvuRRz8ILbV4NnKPjBOF7LNtX8wzFFnTPj215K2mvLHwWKIPMBqqZW3r0ScH5fuyMdycj4hk/El6XczL/P1NL/ItP/UYfyedYmuJ34wyhYo28w2WgEKlI+T3JWD0AzoPfNJXVoqBueDFKVVAAeaw2bSmxoOmFTw+yat25Zw/RaLA3/MPUi3gAAapxbEEz2DKaW7/1mCu3gkAvGWJ12ZmSFcUpTd68sLH19ALWY2ViCDCeVzFZfD9A1pgR+dOV8vVO8RIA1cKF7O0Wjc+OBtPR2C+E/cscr5I1C0nTalpQpn417OVOAhHVLipKcdoWdDFQm3f4SIUmRRrmSnViUNISGWW+94u1OsNUttPMefstF+1eR9IXy+m5tULCepxZF7gypfAMeikwDOua0okusdD8gPIlTHa93KWGGRSRYuytTCZ5wIul82QxXbj+KbT1cJ1rf/vFP8LQJ6Y40ZECf/xpyHIQ8r4tQCtSViseT3dscnQ9gK2pI1o69zLyVp4MxtC7jSpvkN2qf6eNETV51ENegLvP2oAdvXk3PIzaT5+30hbaApRnE5aU9vNANNPEaa7eM0JJLo7QAJDAxnPF7EvsZSLqFkglB849XqRJDpzP7a0xXaXPOsVml6m0vXoGfZvB9UFPSWy51CQJ+vPGRtMbMv/fERPG+Gzfvi8gcO7PeezIqUyFV61Gma3fHbYAhSaZ4NyENAWDiLbvP132sVhHvKpgJ52SPF4g8Nq4qQXRnj/zlTSzOX1omWKN3/a8FRatCXC+5Gm5ZniPapV2dfYLcZ0yM1Jj2A8ikhWEjCyFtvKGP5Mb0eID8j02zHx6T3S5m+kWXMW/qvWAUoIrqtCx3MiO0V65zVvs8P5nebhJOUmvf+ZFPxx1C1uiIDC9dcMfO8FnT3yu+/tXmhd85TWkFbz3I5kPt5L+WBE/6sEq7qXpC5MGNsxw1mr4lMMRN568v65eBH/RVsgkaNyB93HJcL8uqQM+QbE46Z2J854UVrmSX6ZHbCma0NDk+9nCFuynfCWbyGQsnh84PCqyMxG7Fpym4UxMe/cyM/d+XyXVywB3qtiE2/94bT2N5nQsnb2/FWbP4KoTElodOLhUExbgSfg+lHDojIx2cXYSuUY9VQg4kiQdyxtVu5qfBO8vhOkfvCZNTcL7VkNL8yXro6zohutYwTRL9zlHqSyoGaWeveRAb5dg9e/00ZkKJcC1CM3ohQh8Tjsg8Ej45vyLNC20aHa0aWldaVK0GFk343ITlWWSm0w3HsQ2VGfu1kn9IswCeRGL+jIXH+Sm7r6mokVrqf1rs/u79X+Exu0RnILaotKbNl5oNfdrHlR6Kxnf186S8rjOUxvoGqo87zlh1HG06XOktZL/aDEEa/aQOhNxtK8NkutrrqjN8JWIWJpCchY1UbBfTdXH7uUDNg6dzMyv5Uim4aGJUJ+2NsAzcopxFFwZ8qsgscRmAV2xVQZgJDVbX2zu8lX1PFVH8v9cW4yGVISjVhk7Ch+NXj6gEEy9s9oG2cfHw3tFnU56zPxzFuq9o+69rVwLwXVyaJc2QFpfTrcscMf2RkCXyXFoVSV7tTqTLiH1z6F9lqWX0xzky9MDT47QOxr16D5uXiM8eYRbovEJFW5In6/KrPpGbZnrItTLwIiqDI7lAma4/X0GSB+eQLNU090xqjI889lPgrJ1eWzW8GZXyz5MCNZhni+tAFwOu5HQyds0omYziee1Bfy9gBzlhy0kQi3PttBxrMGc8LqSQIUKZMOPCt71xI+MdnGFV7SgHSjrJLhucTGV7bdKDC/d3MwO7yrI3TE3nc0f/WCXd5/ZxlfTIo0tbc8WjIeiF5NMk2Q60aneMYvIUEfWJ9he2O244lmFrn36WSUbEgOSbFy7zb5S4X1sn5/SwLsl5IFNelcJv9C61X1B6rewLVk+9+pfq264ljP6OqIY0O0nnrRtmSxntrOe3VLaqbRkFov+S9juHSQwcWykCtD3GwpGTr2M8tXF7Ps6YNLnFJHZUfVwV5CrsRTujg7P9fS+NZCUkM3I2k20l7ddjbLL9PQFnEvxi+dddut7BSBStOf7lT8wDn1bJ7EL3FikhA8Z5gYBdyFvn66q55oggkjCPkbPV55t3MAnlA+cvcozkKwExMeAw2sQP6LoxjvvV1T6nbtmSJBXwqTTSS65feSaFGJGyzPCxgIoMJxoixLnEQz2XgdaFnBx/IPQO/nNCRO+eKB+mZ5Znr1vzy3WtGtKhAT4N9IH82sm2tiuN1AwjP2wCndGgKkgiI3F3HHenMMGwn0QD6EDtwiO3v0mDLItBlVLeH2WAY477hnQxaf45ianuRHHJVDLX9xtcbfbm6oT9w5SIJcnYwu3OR9mIA01zfyWWA2P9vchMugLGnlLDYHt3L0cAg8xqyYQtP5Yh2qZkDwAh71PFxwZMEChacAGOHIh3KdiGCmRuaWsc2GwitVhgt/FkN+F0uB5oZ7LVALyK3Mghe5+QNQgQE30wrkU4EW1Az7xytdmz3tzuXIYvYh4x+gYczXjvnWa0WLsL3h4p4bFryiUJrv9gmLdnjM/Jq/9P/rybmttmCCy9rh/f3+cXPFp0AT1oTLoo7qyvYxdKfxXzr9mGcSVqZtgXGlGzvzKa7hSWjJ260RwDuP4H7QRloTFrkofA+VB0sgaua25nyfjnCGxlhMmRQPDnaZRUAA4KS5TkeGCVqeTNKpK4Y3YWlP7DFBieoC47IkoP+ez+ggsTyuQ6AA2tFbuahTAiwFJOrUZ2ORFrQ2ZNHISd0OCEp4BBaCn9fOC5dOdUKm0z62AS9HwqTUr5DRxcifS2ulD0ywA1YjIbLBLA8cY1U2Cax4afMBJ2JmnVm2KtJYwA2TGLe1fp1Rq2YxZOmYJ+xfl8BqgRDUevPCa6DwqqCPIGOHnhpEJiwCNA/VM8qgQbSa+PqwEqNEaqTLaYDWUYu5443ATGhoZIuSYBCzDxw0qXl7s+mj2rKhkXOn+9DKOlBcKeLf4BIltuxkDp7eFf4AyWhI+Fd0+AoO9tfdfETvBXzNYjpNCxizoMxq6PO3IwbPN8jZ4Cez2SQvjj1UtNAnB2xpKVtJP84RH7N/Pg8KMZdUZS94rBm9N/QSJHjRznaHCBpPxwIkySqyJHYuiu8Jou1RqQRC3R/Djd0+l5NpO7C/q/qFD8ywQjbYHOdV1Ac9BmGtappnF1Z1GtRMegp2DO7IyNQbc5dOJEWe1oIGSAUYUETUVfvFaFO7v+rnBUk1oFs7LAkOC4yZMUxNvUkNgzq9HIzhZGJ1yqL7TN8YxXy1IZfEFZJo+/KGmKQ+4rv+Z8MQv8A5k6Bfi/po38I+lWnHXFkRJG9RGLw60KFgoigIfgpGlE+KIv+EoMlP4XCmcovYPXl1qOm6MzQrqURPXxwSGWXfAA+lkRowUK44tCLnuHkwrfcfPF9pdlnTT1FJkKNGUpWC95yoJb8A7uo/alpI9npDVzDaIhmsW8ZPd0QDz1KBAFmBh0WLh3R1MfqkzaKQjV70kREpBoxqfM8f8EANn4SwPHtcdgDAmCSHyvVH1T6KVkmHc6u6FXmuxPB3DYCNKeW9p8CCLtIoJGhC/LQSW/R62eFURqos9vYp6+qu3gcQvhKPwGdn0L5Xg9QJj/CVnPtXHEinU7E1P2BUeivHUWi50dF4J8QJobbAM5t0hTx6YxtyRepPlXzgj9P/fwHhTmPmHXOmRyJEbrjwEihu0X3KxNit2i2lUQB60qh5I0b9M1o27VB0Yke1jXFZQCOkNoVm14SfIrcD8BG8E/N3ML/OWPfMq7I7+FlICpAW+3v9/++wqf69b/t+sEG8875GHl/qxRGoNuLr9fMDM7Js3jNMGlI+/WzabGUclramhZcDeiV/OXCHMS9ibPIVLrRAPwyGZfxe13Dyhdbwniq5rPTrSnxvNjSr3Os0TaPS7mOa38cWN2EtuZp5DZN8TNnp6piJMV612R0i4Eub4NFB3LC03qeqtINaH9vS72wyRvlQE/a+rwj2M0VhYUpIp6jrwPNLB/7wMzgEVAug8JTIC3dl+YuSJ4NRpOnQFq2tAOGbzc70reYnqnCtU3OYKPjpp73y+lHpKDt+4IZhlNdFuCC3sgKQPj1V4orX+bBLLoQXFHP+BOz1a4RN2Nj8C02YfTXDUzsRTn6RAIcWkyWX20rESwmaB77qdGrC+92auKinA0I+titLBCS30sSBItqKICttWT1UVbbmpdj+ZGhzYFADK35hUS3/+oomTbjmuTOe4/RhdzKIiqRzUNz+UNJIdZYBKNrfDVyr+C4dQgmUAoAqmHiNhzSAgAe+9hv4M2IAOoFOtKJfmq8aSl6+/hfqKy3TPzq5XnSA5XfIyuxxBAPwAwdP/mk57mDbsfrKKrx2q7kjeFa3QjshKgezrUxWsoXlk/ES+cMn1oAAAA==" alt=""></p> <p>期望是用户在切换 Tab 时 页面时缓存的，当用户关闭 Tab ，重新从左侧菜单打开时是不缓存。</p> <h3 id="路由缓存方案"><a href="#路由缓存方案" class="header-anchor">#</a> 路由缓存方案</h3> <p>这样是持久缓存了整个页面，问题也就出现当用户通过 Tab 关闭页面然后从左侧打开菜单时是缓存的页面，这个不符合日常使用习惯，所以为了解决数据新鲜度的问题可以在 activated 触发查询请求就能保证数据的新鲜度。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">activated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>但是使用后发现由于你切换 Tab 时每次都会请求数据，但是如果项目的数据量有很大频繁请求会给后端造成很大压力 。</p> <h3 id="动态组件缓存方案"><a href="#动态组件缓存方案" class="header-anchor">#</a> 动态组件缓存方案</h3> <p>版本一需要频繁拉去数据导致此方案已不合适只能动态缓存组件方案。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cachedViews<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>其中 cachedViews 是通过监听路由动态增加删除维护要缓存的组件名称（所以组件名称不要重复）数组：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  cachedViews<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">ADD_VIEWS</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> view</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>cachedViews<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    state<span class="token punctuation">.</span>cachedViews<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">DEL_CACHED_VIEW</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> view</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> state<span class="token punctuation">.</span>cachedViews<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>cachedViews<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">addCachedView</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> view</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'ADD_VIEWS'</span><span class="token punctuation">,</span> view<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">deleteCachedView</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> view</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'DEL_CACHED_VIEW'</span><span class="token punctuation">,</span> view<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  state<span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  actions<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>通过监听路由变化：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>watch<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'$route'</span><span class="token punctuation">(</span>newRoute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> newRoute
      <span class="token keyword">const</span> cacheRout <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">ISCACHE_MAP</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      cacheRout<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cached/addCachedView'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> item <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 当通过 Tab 关闭页面时清除组件名称：</span>
<span class="token function">closeTag</span><span class="token punctuation">(</span><span class="token parameter">newRoute</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> newRoute
   <span class="token keyword">const</span> cacheRout <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">ISCACHE_MAP</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
   cacheRout<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'cached/deleteCachedView'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> item <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>但是在遇到嵌套路由时在层级不同的 router-view 中切换 Tab 会出现缓存数据失效的问题，无法缓存组件，嵌套路由如下： <img src="/vuepress-star/assets/img/0021.56c36f32.png" alt=""></p> <h3 id="如何解决"><a href="#如何解决" class="header-anchor">#</a> 如何解决？</h3> <ul><li>方案一：菜单嵌套，路由不嵌套</li></ul> <p>通过维护两套数据，一套嵌套给左侧菜单，一套扁平化后注册路由，改造后的路由： <img src="/vuepress-star/assets/img/0022.117543ca.png" alt=""></p> <ul><li>方案二：修改 keep-alive 把 catch 对象到全局</li></ul> <p>通过上面 keep-alive 解析可以知道，keep-alive就是把通过 include 匹配的组件的 vnode，放到 keep-alive 组件的一个 cache 对象中，下次渲染时，如果能在这里面找到，就直接渲染vnode。所以把这个 cache 对象，放到全局去（全局变量或者 vuex），这样我就可以不用缓存 ParnetView 也能缓存其指定的子组件了。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">removeCacheByName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">/* 省略移除代码 */</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">.</span>KeepAlive<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'NewKeepAlive'</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> cache
    <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> keys
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>方案三：修改 keep-alive 根据路由 name 缓存</li></ul> <p>从上文可以知道 keep-alive 是从 cache 中获取缓存的实例设置到当前的组件上，key 是组件的名称，可以通过改造 getComponentName 方法，组件名称获取更改为路由名称使其缓存的映射关系只与 route name 值有关系。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span><span class="token parameter">opts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>name
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>cache 缓存 key 也更改为路由名称。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/all-smile/vuepress-star/edit/master/docs/fe-skills/Vue/keep-alive实现原理探究.md" target="_blank" rel="noopener noreferrer">本文源码地址</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">1/2/2025, 7:25:54 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-star/fe-skills/Vue/$emit,$on实现原理剖析.html" class="prev">
        $emit,$on实现原理剖析
      </a></span> <span class="next"><a href="/vuepress-star/fe-skills/Vue/diff算法.html">
        diff算法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/vuepress-star/assets/js/app.7a7a38f6.js" defer></script><script src="/vuepress-star/assets/js/2.fea80727.js" defer></script><script src="/vuepress-star/assets/js/6.bb9d2512.js" defer></script><script src="/vuepress-star/assets/js/7.f41a1aee.js" defer></script>
  </body>
</html>
